steps:
  - script: |
      echo "=== Install fixed version of Terraform ==="
      wget -q https://releases.hashicorp.com/terraform/0.12.28/terraform_0.12.28_linux_amd64.zip
      unzip terraform_0.12.28_linux_amd64.zip -d terraform_0.12.28/
      sudo mv terraform_0.12.28/terraform /usr/local/bin/terraform

      terraform --version

      echo "=== Set SSH keypair ==="
      mkdir -p ~/.ssh
      echo -e "$(hana-pipeline-rsa)" > ~/.ssh/id_rsa
      echo -e "$(hana-pipeline-rsa-pub)" > ~/.ssh/id_rsa.pub
      chmod 400 ~/.ssh/id_rsa
      git checkout $(sourceBranchName)

      echo "=== Set agent IP ==="
      echo '##vso[task.setvariable variable=agent_ip]$(curl -s https://ipinfo.io/json | jq -r .ip)'
    displayName: "Pre deployment"
